<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>动态评估测试示例</title>
  <style>
    /* 整体页面背景和字体设置 */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* 内容容器 */
    .container {
      max-width: 800px;
      width: 90%;
      background-color: #fff;
      padding: 30px 40px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      margin: 40px;
    }
    /* 标题 */
    h3 {
      text-align: center;
      color: #333;
      margin-bottom: 25px;
    }
    /* 高亮样式 */
    .highlight {
      background-color: #fffd9e;
      padding: 3px 8px;
      border-radius: 3px;
      font-weight: bold;
    }
    /* 正文段落 */
    p {
      font-size: 18px;
      line-height: 1.8;
      color: #555;
      margin-bottom: 20px;
    }
    /* 题目选择项 */
    form label {
      display: block;
      font-size: 18px;
      margin: 10px 0;
      cursor: pointer;
    }
    input[type="radio"] {
      margin-right: 10px;
    }
    /* 按钮 */
    button {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #45a049;
    }
    /* 错误反馈区域 */
    .level {
      display: none;
      margin-top: 20px;
      padding: 20px;
      border: 2px solid #ddd;
      border-radius: 5px;
      background-color: #f9f9f9;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    /* 错误提示符号 */
    .symbol {
      font-size: 24px;
      margin-right: 10px;
      color: #d32f2f;
    }
  </style>
</head>
<body>
  <div class="container">
    <h3>根据上下文推断加粗词汇 <strong class="highlight">ambivalent</strong> 的意思：</h3>

    <p>
      Jenny felt ambivalent about the summer camp. “It’s free and fun!” her friend said excitedly, already planning what to pack. With a smile, Jenny drew a big checkmark in the “YES” box on the form.
      <span id="highlight-sentence">Then her hand stopped. She looked at the two big piles of summer homework on the desk. One was math. The other was a thick reading packet.</span>
      Outside, children laughed while playing in the sun. Jenny opened her window slightly. The breeze smelled like cut grass. She sat there for a moment, not moving, the form still open in front of her.
    </p>

    <p><strong>请选择正确的含义：</strong></p>
    <form id="quizForm">
      <label><input type="radio" name="answer" value="A"> A. 伤心的</label>
      <label><input type="radio" name="answer" value="B"> B. 矛盾的</label>
      <label><input type="radio" name="answer" value="C"> C. 兴奋的</label>
      <label><input type="radio" name="answer" value="D"> D. 冷漠的</label>
      <label><input type="radio" name="answer" value="E"> E. 困惑的</label>
      <button type="button" onclick="checkAnswer()">提交答案</button>
    </form>

    <div id="level1" class="level">
      <span class="symbol">✖</span><strong>Incorrect！</strong> Please try again. Take another close look at the highlighted sentences—what do the changes in the character’s actions suggest? How did that make you feel?
    </div>
    <div id="level2" class="level">
      <span class="symbol">✖</span><strong>Incorrect！</strong> Please try again. Based on highlighted sentences, try to think about why Jenny first smiled and checked the ‘YES’ box, but then suddenly stopped and stared at her homework. What do you think she might be thinking? How does that make you feel?
    </div>
    <div id="level3" class="level">
      <span class="symbol">✖</span><strong>Incorrect！</strong> Please try again. If you were Jenny—excited about summer camp but also facing piles of summer homework—what complex feelings might you experience in that moment?
    </div>
    <div id="level4" class="level">
      <span class="symbol">✖</span><strong>Incorrect！</strong> Jenny’s actions suggest that she wanted to go to summer camp but was also worried about her unfinished homework. This kind of feeling—wanting something but hesitating due to other concerns—is best described as ‘矛盾的’.
    </div>
  </div>

  <script>
    // 全局变量：记录错误次数与所有选择记录
    let attempt = 0;
    let answerHistory = [];

    // 核心函数：判断答案并提交数据
    function checkAnswer() {
      // 提交前先将错误反馈隐藏
      document.querySelectorAll('.level').forEach(function(el) {
        el.style.display = 'none';
      });

      // 遍历单选按钮，记录用户的选择
      const radios = document.getElementsByName("answer");
      let selected = '';
      for (const radio of radios) {
        if (radio.checked) {
          selected = radio.value;
          answerHistory.push(selected);
          break;
        }
      }

      // 正确答案为 "B"
      if (selected === "B") {
        let rawScore = Math.max(0, 4 - attempt); // 原始得分
        let potentialScore = ((4 - attempt) / 4).toFixed(2); // 潜力得分，保留两位小数
        alert("答案正确！✔");
        // 调用函数将数据提交到问卷星后台
        submitToWJX(answerHistory, rawScore, potentialScore);
        clearSelection();
      } else {
        attempt++;
        if (attempt === 1) {
          document.getElementById('highlight-sentence').classList.add('highlight');
        }
        if (attempt <= 4) {
          document.getElementById('level' + attempt).style.display = 'block';
          clearSelection();
        } else {
          alert("请重新检查你的理解，答案应为‘矛盾的’。");
          submitToWJX(answerHistory, 0, 0);
          clearSelection();
        }
      }
    }

    // 清除单选按钮选中状态
    function clearSelection() {
      const radios = document.getElementsByName("answer");
      radios.forEach(radio => radio.checked = false);
    }

    // 新增函数：将数据提交至问卷星后台（注意替换你的问卷ID）
    function submitToWJX(history, rawScore, potentialScore) {
      // 注意：替换下面 "你的问卷ID" 为实际的问卷星问卷 ID，
      // 提交链接格式通常为： https://www.wjx.cn/joinnew/processjq.ashx?submittype=1&curid=你的问卷ID
      const wjxUrl = 'https://www.wjx.cn/joinnew/processjq.ashx?submittype=1&curid=你的问卷ID';

      const payload = new URLSearchParams();
      // 提交数据字段：q1 为选项历史（用逗号分隔），q2 为原始得分，q3 为潜力得分
      payload.append('submitdata', JSON.stringify({
        q1: history.join(","),
        q2: rawScore.toString(),
        q3: potentialScore.toString()
      }));

      fetch(wjxUrl, {
        method: 'POST',
        headers: {
          "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
        },
        body: payload
      })
      .then(() => {
        console.log('数据已提交至问卷星后台');
      })
      .catch((error) => {
        console.error('提交失败:', error);
      });
    }
  </script>
</body>
</html>
